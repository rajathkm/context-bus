Metadata-Version: 2.4
Name: context-bus
Version: 0.2.0
Summary: Automatic model switching for AI coding agents with full context preservation
Author-email: Rajath KM <rajathkm@gmail.com>
License: MIT
Project-URL: Homepage, https://github.com/rajathkm/context-bus
Project-URL: Documentation, https://github.com/rajathkm/context-bus#readme
Project-URL: Repository, https://github.com/rajathkm/context-bus
Project-URL: Issues, https://github.com/rajathkm/context-bus/issues
Keywords: ai,llm,claude,codex,gemini,model-switching,context
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pyyaml>=6.0
Requires-Dist: click>=8.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: black>=23.0; extra == "dev"
Dynamic: license-file

# Context Bus

**Seamless multi-model orchestration for OpenClaw agents.**

Automatically switch between Claude Opus, Codex, and Gemini when you hit usage limits â€” without losing context. Your agent keeps working, you get notified, and everything Just Worksâ„¢.

[![PyPI](https://img.shields.io/pypi/v/context-bus)](https://pypi.org/project/context-bus/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Linux-blue)]()

> ğŸ”— **GitHub:** https://github.com/rajathkm/context-bus
> 
> ğŸ“¦ **Install:** `pip install context-bus && context-bus init`

---

## âš ï¸ Safe Install â€” Works With or Without Existing Files

Context Bus is designed to **augment, not replace**. It works whether you're starting fresh or already have an established agent setup:

| File | If It Already Exists | If It Doesn't Exist |
|------|---------------------|---------------------|
| `AGENTS.md` | âœ… **Left untouched** â€” your content is safe | âœ… **Auto-created** with starter template |
| `MEMORY.md` | âœ… **Left untouched** â€” your content is safe | âœ… **Auto-created** with starter template |
| `HEARTBEAT.md` | âœ… **Augmented** â€” adds Context Bus section only | âœ… **Auto-created** with monitoring rules |
| `config.yaml` | âœ… **Left untouched** â€” your settings preserved | âœ… **Auto-created** with sensible defaults |

### New Users (No Existing Files)

If you're installing Context Bus in a fresh workspace:
- All necessary files are **automatically created** for you
- **Works immediately** â€” no configuration required
- Usage monitoring and auto-switching start right away
- Optionally customize `AGENTS.md` later to improve context sharing between models

### Existing OpenClaw Users (Already Have Files)

If you already have `AGENTS.md`, `MEMORY.md`, or `HEARTBEAT.md`:
- **Your content is 100% preserved** â€” nothing is overwritten
- Context Bus only **adds** its monitoring section to `HEARTBEAT.md`
- Your existing agent memory, context, and rules remain intact

**Bottom line:** Context Bus adapts to your setup. Install confidently.

---

## What Is This?

Context Bus solves a common problem for AI power users:

> **You're deep in work with Claude Opus. You hit the usage limit. Now what?**

Without Context Bus:
- âŒ Switch to another model manually
- âŒ Re-explain everything to the new model
- âŒ Lose track of decisions and progress
- âŒ Waste time catching up

With Context Bus:
- âœ… Automatic switch when limits approach
- âœ… Full context preserved in shared files
- âœ… Get notified on Telegram/Discord/Slack
- âœ… Auto-switch back when limits reset

---

## Quick Start (OpenClaw/Clawdbot Users)

> **Built for OpenClaw** â€” Context Bus integrates seamlessly with your Clawdbot.
> 
> ğŸ“– Full docs: https://github.com/rajathkm/context-bus

### 1. Install

```bash
pip install context-bus
context-bus init
```

Or just tell your Clawdbot:
```
"Install Context Bus for automatic model switching"
```

Your Clawdbot will run the install command and set everything up automatically.

### 2. That's It â€” No Config Needed

The installer automatically:
- âœ… Creates shared context files (`AGENTS.md`, `MEMORY.md`)
- âœ… Adds usage monitoring rules to your `HEARTBEAT.md`
- âœ… Sets up a background monitor (every 10 minutes)
- âœ… Initializes state tracking (`~/.context-bus/handoff.json`)

Your Clawdbot will now:
1. Check usage on every heartbeat
2. Update the handoff file with current usage %
3. Auto-switch at 95% usage
4. Notify you when switching
5. Switch back when limits reset

---

## How It Works

### The Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YOUR CLAWDBOT                            â”‚
â”‚                                                             â”‚
â”‚  Heartbeat fires every ~30 min                              â”‚
â”‚       â†“                                                     â”‚
â”‚  Reads HEARTBEAT.md â†’ sees Context Bus rules                â”‚
â”‚       â†“                                                     â”‚
â”‚  Runs session_status â†’ "Usage: 87%"                         â”‚
â”‚       â†“                                                     â”‚
â”‚  Runs: ~/.context-bus/update-usage.sh 87                    â”‚
â”‚       â†“                                                     â”‚
â”‚  handoff.json updated: usage_percent = 87                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BACKGROUND MONITOR (every 10 min)             â”‚
â”‚                                                             â”‚
â”‚  Reads handoff.json â†’ usage = 87%                           â”‚
â”‚  87% < 95% threshold â†’ no action                            â”‚
â”‚                                                             â”‚
â”‚  [Next check: usage = 96%]                                  â”‚
â”‚  96% >= 95% â†’ TRIGGER SWITCH                                â”‚
â”‚       â†“                                                     â”‚
â”‚  Update handoff.json: model = "codex"                       â”‚
â”‚  Send notification: "ğŸ”„ Switched to Codex (96%)"            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MODELS                                  â”‚
â”‚                                                             â”‚
â”‚   Opus (Primary) â†â†’ Codex (Secondary) â†â†’ Gemini (Tertiary) â”‚
â”‚                                                             â”‚
â”‚   All models read the same context files:                   â”‚
â”‚   â€¢ AGENTS.md â€” project context, current task               â”‚
â”‚   â€¢ MEMORY.md â€” long-term memory, decisions                 â”‚
â”‚   â€¢ handoff.json â€” structured state                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Shared Context Files

All models read from the same files, so context is never lost:

**AGENTS.md** â€” Project context that every model sees:
```markdown
# AGENTS.md

## Project Context
Building a task management API with PostgreSQL.

## Current Task  
Implementing OAuth authentication.

## Key Constraints
- Use TypeScript
- Write tests for all endpoints
- Follow existing patterns

## Decisions Made
- JWT tokens with 1-hour expiry
- Refresh tokens in httpOnly cookies
```

**MEMORY.md** â€” Long-term memory across sessions:
```markdown
# MEMORY.md

## Lessons Learned
- Always run migrations before testing
- User prefers concise responses

## User Preferences
- TypeScript over JavaScript
- Prefers functional patterns
```

**handoff.json** â€” Machine-readable state:
```json
{
  "model": {
    "current": "codex",
    "previous": "opus",
    "usage_percent": 96,
    "switch_reason": "auto_threshold"
  },
  "task": {
    "description": "Implementing OAuth",
    "status": "in_progress"
  },
  "next_steps": ["Add token refresh", "Write tests"]
}
```

---

## Installation

### For OpenClaw/Clawdbot Users

```bash
pip install context-bus
context-bus init
```

The installer will:
1. Create `~/.context-bus/` with scripts and state
2. Create `~/.config/context-bus/config.yaml`
3. Add `AGENTS.md` and `MEMORY.md` to your workspace (if they don't exist)
4. **Augment** your `HEARTBEAT.md` with usage monitoring rules (won't overwrite existing content)
5. Set up background monitor (launchd on macOS, cron on Linux)

### For Other Agents (Claude Code, Cursor, etc.)

```bash
pip install context-bus
context-bus init
```

Then add to your agent's system prompt:
```
Before starting work, read AGENTS.md and MEMORY.md for context.
After significant work, update these files.
Periodically check ~/.context-bus/handoff.json for model state.
```

---

## Configuration

Edit `~/.config/context-bus/config.yaml`:

```yaml
# Models
models:
  primary: opus        # Your main model
  secondary: codex     # Fallback when primary hits limits
  tertiary: gemini     # Optional third fallback

# Thresholds
thresholds:
  switch_to_secondary: 95    # Switch at 95% usage
  switch_back: 50            # Switch back when usage drops below 50%

# Notifications
notifications:
  enabled: true
  channel: telegram          # telegram | discord | slack | none
  telegram:
    chat_id: "YOUR_CHAT_ID"  # Get from @userinfobot on Telegram
```

---

## CLI Commands

```bash
# Initialize in a workspace
context-bus init

# Check current status
context-bus status

# Manual model switching
context-bus switch codex
context-bus switch opus

# View/edit configuration
context-bus config --show
context-bus config --edit
```

---

## What Gets Installed

```
~/.context-bus/
â”œâ”€â”€ handoff.json           # Current state (model, usage, task)
â”œâ”€â”€ rolling-summary.md     # Human-readable session summary
â”œâ”€â”€ usage-monitor.sh       # Background monitor script
â”œâ”€â”€ update-usage.sh        # Update usage percentage
â”œâ”€â”€ context-handoff.sh     # Generate handoff for model switch
â””â”€â”€ monitor.log            # Monitor logs

~/.config/context-bus/
â””â”€â”€ config.yaml            # Your configuration

~/your-workspace/
â”œâ”€â”€ AGENTS.md              # Shared project context
â”œâ”€â”€ MEMORY.md              # Long-term memory
â””â”€â”€ HEARTBEAT.md           # + Context Bus monitoring rules
```

---

## Safety Features

Context Bus includes safeguards to prevent issues:

| Feature | What It Does |
|---------|--------------|
| **Safe augment** | Never overwrites existing files, only adds to them |
| **Task check** | Won't switch back to primary if a task is in progress |
| **Cooldown** | Minimum 5 minutes between switches |
| **Notifications** | Always notifies you when switching |

---

## Notifications

### Telegram (Recommended for OpenClaw)

1. Message [@userinfobot](https://t.me/userinfobot) to get your chat ID
2. Add to config:
```yaml
notifications:
  channel: telegram
  telegram:
    chat_id: "123456789"
```

You'll get messages like:
```
ğŸ”„ [Context Bus] Opus â†’ Codex
   Usage: 96%
   Context preserved âœ“

ğŸ”„ [Context Bus] Codex â†’ Opus  
   Limits reset (usage: 12%)
   Welcome back!
```

### Discord

```yaml
notifications:
  channel: discord
  discord:
    webhook_url: "https://discord.com/api/webhooks/..."
```

### Slack

```yaml
notifications:
  channel: slack
  slack:
    webhook_url: "https://hooks.slack.com/services/..."
```

---

## Troubleshooting

### Auto-switch didn't trigger

**Cause:** Usage wasn't being updated in handoff.json

**Fix:** Ensure your HEARTBEAT.md has the Context Bus rules. Check:
```bash
grep "Context Bus" ~/your-workspace/HEARTBEAT.md
```

If missing, re-run `context-bus init` or manually add the rules.

### Notifications not sending

**Fix:** Verify your chat ID:
```bash
cat ~/.config/context-bus/config.yaml | grep chat_id
```

### Check monitor status

```bash
# macOS
launchctl list | grep contextbus

# View logs
tail -20 ~/.context-bus/monitor.log
```

---

## Uninstall

```bash
pip uninstall context-bus

# Remove files
rm -rf ~/.context-bus ~/.config/context-bus

# macOS: remove launchd job
launchctl unload ~/Library/LaunchAgents/com.contextbus.monitor.plist
rm ~/Library/LaunchAgents/com.contextbus.monitor.plist
```

---

## Links

- **PyPI:** https://pypi.org/project/context-bus/
- **GitHub:** https://github.com/rajathkm/context-bus
- **Issues:** https://github.com/rajathkm/context-bus/issues
- **OpenClaw:** https://github.com/openclaw/openclaw

---

## License

MIT License - see [LICENSE](LICENSE)

---

## Contributing

Contributions welcome! See [CONTRIBUTING.md](CONTRIBUTING.md)
